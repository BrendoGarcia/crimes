name: CI de Testes Automatizados

on:
  workflow_dispatch:
  push:
    branches:
      - Front-end
      - demo
  pull_request:
    branches:
      - Front-end
      - demo

jobs:

  testes-unitarios:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout da branch Front-end
      uses: actions/checkout@v4
      with:
        ref: Front-end
        path: frontend

    - name: Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json

    - name: Instalar dependências
      working-directory: frontend
      run: |
        npm install
        npm install --save-dev jest ts-jest @types/jest \
          jest-environment-jsdom \
          babel-jest @babel/preset-env @babel/preset-react @babel/preset-typescript \
          @testing-library/react @testing-library/jest-dom

    - name: Rodar testes unitários
      working-directory: frontend
      run: npx jest --watchAll=false --testPathPatterns=src/screens/AnalysisScreen.test.tsx


  testes-funcionais:
    runs-on: ubuntu-latest
    needs: testes-unitarios

    steps:
    - name: Checkout da branch demo
      uses: actions/checkout@v4
      with:
        ref: demo
        path: demo

    - name: Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Instalar dependências do Selenium
      working-directory: demo
      run: |
        npm install
        npm install selenium-webdriver chromedriver jest

    - name: Instalar o Google Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable

    - name: Criar arquivo de teste funcional
      working-directory: demo
      run: |
        mkdir -p tests/functional
        echo "/* arquivo de teste */" > tests/functional/AnalysisScreen.functional.test.js

    - name: Rodar testes funcionais
      working-directory: demo
      run: npx jest tests/functional/AnalysisScreen.functional.test.js
