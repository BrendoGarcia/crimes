name: CI de Testes Automatizados

on:
  push:
    branches: 
      - "Front-end"
      - "demo"
  pull_request:
    branches:
      - "Front-end"
      - "demo"

jobs:
  testes-unitarios:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout do código
      uses: actions/checkout@v4
      with:
        path: frontend

    - name: Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: frontend/package-lock.json

    - name: Instalar dependências (Front-end)
      run: npm install
      working-directory: frontend

    - name: Rodar testes unitários (Jest)
      run: npm test -- --watchAll=false --testPathPattern=src/screens/AnalysisScreen.test.tsx
      working-directory: frontend

  testes-funcionais:
    runs-on: ubuntu-latest
    needs: testes-unitarios
    steps:
    - name: Checkout do código
      uses: actions/checkout@v4
      with:
        path: demo

    - name: Configurar Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: demo/package-lock.json

    - name: Instalar dependências (demo)
      run: npm install selenium-webdriver chromedriver jest
      working-directory: demo

    - name: Instalar o Google Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable

    - name: Criar arquivo de teste funcional
      run: |
        mkdir -p tests/functional
        echo "/* seu arquivo gigante aqui */" > tests/functional/AnalysisScreen.functional.test.js
      working-directory: demo

    - name: Rodar testes funcionais
      run: npx jest tests/functional/AnalysisScreen.functional.test.js
      working-directory: demo
